client:
  input:
    method: POST
    endpoint: /testservice
    body(JSON):
      query: >
        {
          hero(episode: EMPIRE) {
            id, name, appearsIn
            ...droidFrag
            ...humanFrag
            friendsConnection {
              totalCount
              friends {
                id, name, appearsIn
                ...droidFrag
                ...humanFrag
              }
            }
          }
          starship(id:"3001") { name, length(unit:FOOT) }
        }
        fragment droidFrag on Droid { primaryFunction }
        fragment humanFrag on Human { height(unit: FOOT), mass }


  expect-response:
    status: 200
    headers:
      Content-Length: ^166$
      Content-Type: ^text/plain; charset=utf-8$
      Server: ^fasthttp$
      Date: .
      X-Custom-Header: value
    body(JSON):
      data:
        "hero": {
          "id": "1000",
          "name": "Luke Skywalker",
          "height": 5.6430448,
          "mass": 77,
          "appearsIn": [
            "NEWHOPE",
            "EMPIRE",
            "JEDI"
          ],
          "friendsConnection": {
            "totalCount": 4,
            "friends": [
              {
                "id": "1002",
                "name": "Han Solo",
                "appearsIn": [
                  "NEWHOPE",
                  "EMPIRE",
                  "JEDI"
                ],
                "height": 5.905512,
                "mass": 80
              },
              {
                "id": "1003",
                "name": "Leia Organa",
                "appearsIn": [
                  "NEWHOPE",
                  "EMPIRE",
                  "JEDI"
                ],
                "height": 4.92126,
                "mass": 49
              },
              {
                "id": "2000",
                "name": "C-3PO",
                "appearsIn": [
                  "NEWHOPE",
                  "EMPIRE",
                  "JEDI"
                ],
                "primaryFunction": "Protocol"
              },
              {
                "id": "2001",
                "name": "R2-D2",
                "appearsIn": [
                  "NEWHOPE",
                  "EMPIRE",
                  "JEDI"
                ],
                "primaryFunction": "Astromech"
              }
            ]
          }
        }
        "starship": {
          "name": "X-Wing",
          "length": 41.0105
        }

destination:
  expect-forwarded:
    headers:
      X-Forwarded-Host: ^localhost:8000$
      X-Forwarded-For: 0.0.0.0
      X-Forwarded-Proto: ^HTTP/1.1$
      Host: ^localhost:8081$
      Content-Length: ^97$
      Content-Type: ^application/json$
      User-Agent: ^fasthttp$
      Date: .
    body(JSON):
      query: >
        {
          hero(episode: EMPIRE) {
            id, name, appearsIn
            ...droidFrag
            ...humanFrag
            friendsConnection {
              totalCount
              friends {
                id, name, appearsIn
                ...droidFrag
                ...humanFrag
              }
            }
          }
          starship(id:"3001") { name, length(unit:FOOT) }
        }
        fragment droidFrag on Droid { primaryFunction }
        fragment humanFrag on Human { height(unit: FOOT), mass }

  response:
    status: 200
    headers:
      X-Custom-Header: value
    body(JSON):
      data:
        "hero": {
          "id": "1000",
          "name": "Luke Skywalker",
          "height": 5.6430448,
          "mass": 77,
          "appearsIn": [
            "NEWHOPE",
            "EMPIRE",
            "JEDI"
          ],
          "friendsConnection": {
            "totalCount": 4,
            "friends": [
              {
                "id": "1002",
                "name": "Han Solo",
                "appearsIn": [
                  "NEWHOPE",
                  "EMPIRE",
                  "JEDI"
                ],
                "height": 5.905512,
                "mass": 80
              },
              {
                "id": "1003",
                "name": "Leia Organa",
                "appearsIn": [
                  "NEWHOPE",
                  "EMPIRE",
                  "JEDI"
                ],
                "height": 4.92126,
                "mass": 49
              },
              {
                "id": "2000",
                "name": "C-3PO",
                "appearsIn": [
                  "NEWHOPE",
                  "EMPIRE",
                  "JEDI"
                ],
                "primaryFunction": "Protocol"
              },
              {
                "id": "2001",
                "name": "R2-D2",
                "appearsIn": [
                  "NEWHOPE",
                  "EMPIRE",
                  "JEDI"
                ],
                "primaryFunction": "Astromech"
              }
            ]
          }
        }
        "starship": {
          "name": "X-Wing",
          "length": 41.0105
        }
logs:
  - level: info
    message: 'listening'
    host: localhost:8080
    tls: false
    services:
      - testservice
  - level: info
    message: 'handling request'
    path: /testservice
  - level: debug
    path: /testservice
    query: '{"query":"query { queryFirstField { queryFirstSubfield querySecondSubfield } querySecondField }"}'
